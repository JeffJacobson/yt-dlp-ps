# _type                  : playlist


class PlaylistInfo {
    # "UC8aNN-LQ7nAl8cW9xX-hv8w",
    [string]
    $id

    # "FT Depot",
    [string]
    $uploader

    # "UC8aNN-LQ7nAl8cW9xX-hv8w",
    [string]
    $uploader_id

    # "https://www.youtube.com/channel/UC8aNN-LQ7nAl8cW9xX-hv8w",
    [uri]
    $uploader_url

    # "FT Depot - Videos",
    [string]
    $title

    # 21700,
    [int]
    $channel_follower_count

    # "35mm (and occasionally 16mm) scans of random and occasionally interesting things from the past when cinemas ran actual film.\n\nWe have invested a LOT of time and money into this project and are posting the files WITHOUT a burned-in watermark for those who want to download the videos for their own home private use.  All we ask in return is for everyone to please show professional respect by LINKING to the video on our youtube page instead of re-uploading our videos to your channel or elsewhere on the internet (or selling them on physical media).\n\nPLEASE UNDERSTAND IF OUR WORK IS RE-UPLOADED BY OTHERS OR SOLD ON PHYSICAL MEDIA TO PASS IT OFF AS THEIR OWN, WE WILL HAVE NO OPTION BUT TO WATERMARK OUR FUTURE VIDEOS OR TAKE OTHER ACTION.\n\n100% of the content on this channel was scanned and restored by us from original film elements.  If you are in need of professional film scanning services, please email us at the business inquiries email below.  \n\nThank you for your support.",
    [string]
    $description

    # "\"35mm scan motion picture cinema policy trailer preview\"",
    [string]
    $tags

    # "                  ",
    [string]
    $thumbnails

    # 1005,
    [int]
    $playlist_count

    # "FT Depot",
    [string]
    $channel

    # "UC8aNN-LQ7nAl8cW9xX-hv8w",
    [string]
    $channel_id

    # "https://www.youtube.com/channel/UC8aNN-LQ7nAl8cW9xX-hv8w",
    [string]
    $channel_url

    # "playlist",
    [string]
    $_type

    # "YoutubeTab",
    [string]
    $extractor_key

    # "youtube:tab",
    [string]
    $extractor

    # "https://www.youtube.com/@FTDepot/videos",
    [string]
    $webpage_url

    # "videos",
    [string]
    $webpage_url_basename

    # "youtube.com",
    [string]
    $webpage_url_domain

    # 1672380741,
    [int]
    $epoch

    # "@{version=2022.11.11; release_git_head=8b64402; repository=yt-dlp/yt-dlp}"
    [string]
    $_version
}

class VideoInfo {
    # "5t7ii5PwYQI",
    [string]
    $id

    # "Friday the 13th Midnight Show Snipe (1961) [4K] [FTD-0933]",
    [string]
    $title

    # "                          ",
    [string]
    $formats

    # "                                         ",
    [string]
    $thumbnails

    # "https://i.ytimg.com/vi_webp/5t7ii5PwYQI/maxresdefault.webp",
    [string]
    $thumbnail

    # "35mm 4K film scan",
    [string]
    $description

    # "FT Depot",
    [string]
    $uploader

    # "UC8aNN-LQ7nAl8cW9xX-hv8w",
    [string]
    $uploader_id

    # "http://www.youtube.com/channel/UC8aNN-LQ7nAl8cW9xX-hv8w",
    [string]
    $uploader_url

    # "UC8aNN-LQ7nAl8cW9xX-hv8w",
    [string]
    $channel_id

    # "https://www.youtube.com/channel/UC8aNN-LQ7nAl8cW9xX-hv8w",
    [string]
    $channel_url

    # 14,
    [string]
    $duration

    # 279,
    [string]
    $view_count

    # 0,
    [string]
    $age_limit

    # "https://www.youtube.com/watch?v=5t7ii5PwYQI",
    [string]
    $webpage_url

    # "Film & Animation",
    [string]
    $categories

    # "35mm scan",
    [string]
    $tags

    # true,
    [string]
    $playable_in_embed

    # false,
    [string]
    $is_live

    # false,
    [string]
    $was_live

    # "not_live",
    [string]
    $live_status

    # "@{af=System.Object[]; ak=System.Object[]; sq=System.Object[]; am=System.Object[]; ar=System.Object[]; hy=System.Object[]; as=System.Object[]; ay=System.Object[]; az=System.Object[]; bn=System.Object[]; eu=System.Object[]; be=System.Object[]; bho=System.Object[]; bs=System.Object[]; bg=System.Object[]; my=System.Object[]; ca=System.Object[]; ceb=System.Object[]; zh-Hans=System.Object[]; zh-Hant=System.Object[]; co=System.Object[]; hr=System.Object[]; cs=System.Object[]; da=System.Object[]; dv=System.Object[]; nl=System.Object[]; en-orig=System.Object[]; en=System.Object[]; eo=System.Object[]; et=System.Object[]; ee=System.Object[]; fil=System.Object[]; fi=System.Object[]; fr=System.Object[]; gl=System.Object[]; lg=System.Object[]; ka=System.Object[]; de=System.Object[]; el=System.Object[]; gn=System.Object[]; gu=System.Object[]; ht=System.Object[]; ha=System.Object[]; haw=System.Object[]; iw=System.Object[]; hi=System.Object[]; hmn=System.Object[]; hu=System.Object[]; is=System.Object[]; ig=System.Object[]; id=System.Object[]; ga=System.Object[]; it=System.Object[]; ja=System.Object[]; jv=System.Object[]; kn=System.Object[]; kk=System.Object[]; km=System.Object[]; rw=System.Object[]; ko=System.Object[]; kri=System.Object[]; ku=System.Object[]; ky=System.Object[]; lo=System.Object[]; la=System.Object[]; lv=System.Object[]; ln=System.Object[]; lt=System.Object[]; lb=System.Object[]; mk=System.Object[]; mg=System.Object[]; ms=System.Object[]; ml=System.Object[]; mt=System.Object[]; mi=System.Object[]; mr=System.Object[]; mn=System.Object[]; ne=System.Object[]; nso=System.Object[]; no=System.Object[]; ny=System.Object[]; or=System.Object[]; om=System.Object[]; ps=System.Object[]; fa=System.Object[]; pl=System.Object[]; pt=System.Object[]; pa=System.Object[]; qu=System.Object[]; ro=System.Object[]; ru=System.Object[]; sm=System.Object[]; sa=System.Object[]; gd=System.Object[]; sr=System.Object[]; sn=System.Object[]; sd=System.Object[]; si=System.Object[]; sk=System.Object[]; sl=System.Object[]; so=System.Object[]; st=System.Object[]; es=System.Object[]; su=System.Object[]; sw=System.Object[]; sv=System.Object[]; tg=System.Object[]; ta=System.Object[]; tt=System.Object[]; te=System.Object[]; th=System.Object[]; ti=System.Object[]; ts=System.Object[]; tr=System.Object[]; tk=System.Object[]; uk=System.Object[]; und=System.Object[]; ur=System.Object[]; ug=System.Object[]; uz=System.Object[]; vi=System.Object[]; cy=System.Object[]; fy=System.Object[]; xh=System.Object[]; yi=System.Object[]; yo=System.Object[]; zu=System.Object[]}",
    [string]
    $automatic_captions

    # "",
    [string]
    $subtitles

    # 4,
    [string]
    $comment_count

    # 28,
    [string]
    $like_count

    # "FT Depot",
    [string]
    $channel

    # 19300,
    [string]
    $channel_follower_count

    # "20221020",
    [string]
    $upload_date

    # "public",
    [string]
    $availability

    # "watch",
    [string]
    $webpage_url_basename

    # "youtube.com",
    [string]
    $webpage_url_domain

    # "youtube",
    [string]
    $extractor

    # "Youtube",
    [string]
    $extractor_key

    # 934,
    [string]
    $playlist_count

    # "FT Depot - Videos",
    [string]
    $playlist

    # "UC8aNN-LQ7nAl8cW9xX-hv8w",
    [string]
    $playlist_id

    # "FT Depot - Videos",
    [string]
    $playlist_title

    # "FT Depot",
    [string]
    $playlist_uploader

    # "UC8aNN-LQ7nAl8cW9xX-hv8w",
    [string]
    $playlist_uploader_id

    # 934,
    [string]
    $n_entries

    # 1,
    [string]
    $playlist_index

    # "5t7ii5PwYQI",
    [string]
    $display_id

    # "Friday the 13th Midnight Show Snipe (1961) [4K] [FTD-0933]",
    [string]
    $fulltitle

    # "14",
    [string]
    $duration_string

    # "   ",
    [string]
    $comments

    # 44100,
    [string]
    $asr

    # "22",
    [string]
    $format_id

    # "720p",
    [string]
    $format_note

    # -5,
    [string]
    $source_preference

    # 24,
    [string]
    $fps

    # 2,
    [string]
    $audio_channels

    # 720,
    [string]
    $height

    # 8,
    [string]
    $quality

    # false,
    [string]
    $has_drm

    # 2222.106,
    [string]
    $tbr

    # "https://rr1---sn-jxou0gtapo3-nx5e.googlevideo.com/videoplayback?expire=1666338330&ei=uvlRY6XLEMOJkgbGyKDoBg&ip=71.212.102.66&id=o-AIr5F-ZzYRWECZ0cMPgD953T38E_HpknwrF33WY25idr&itag=22&source=youtube&requiressl=yes&mh=Cu&mm=31%2C29&mn=sn-jxou0gtapo3-nx5e%2Csn-nx5s7n7s&ms=au%2Crdu&mv=m&mvi=1&pl=17&initcwndbps=970000&spc=yR2vp4WLj_7mqNn_4p9JOf_ZSGQmx14&vprv=1&svpuc=1&mime=video%2Fmp4&cnr=14&ratebypass=yes&dur=13.769&lmt=1666256436222470&mt=1666316217&fvip=4&fexp=24001373%2C24007246&c=ANDROID&txp=5318224&sparams=expire%2Cei%2Cip%2Cid%2Citag%2Csource%2Crequiressl%2Cspc%2Cvprv%2Csvpuc%2Cmime%2Ccnr%2Cratebypass%2Cdur%2Clmt&sig=AOq0QJ8wRQIhAM0iZ3TnOUephSH8Qoh_qsvERhg7QYAPfW8GLZ0SPjImAiB1Uy24IbCTzxdVrHbW5n7zdfaHFjMyHsW3lvHolUraZA%3D%3D&lsparams=mh%2Cmm%2Cmn%2Cms%2Cmv%2Cmvi%2Cpl%2Cinitcwndbps&lsig=AG3C_xAwRQIhANSslgh8lp6tFfLf0CfIkE3Cz-PUslRdWU-bVxIXzum1AiBq4UZF0qplAajSh5tqHr0sKWobYy127izqUxgPSRTHSw%3D%3D",
    [string]
    $url

    # 1280,
    [string]
    $width

    # "",
    [string]
    $language

    # -1,
    [string]
    $language_preference

    # "mp4",
    [string]
    $ext

    # "avc1.64001F",
    [string]
    $vcodec

    # "mp4a.40.2",
    [string]
    $acodec

    # "SDR",
    [string]
    $dynamic_range

    # "https",
    [string]
    $protocol

    # "mp4",
    [string]
    $video_ext

    # "none",
    [string]
    $audio_ext

    # 2222.106,
    [string]
    $vbr

    # 0.0,
    [string]
    $abr

    # "22 - 1280x720 (720p)",
    [string]
    $format

    # "1280x720",
    [string]
    $resolution

    # 3982013,
    [string]
    $filesize_approx

    # "@{User-Agent=Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/92.0.4515.43 Safari/537.36; Accept=text/html,application/xhtml+xml,application/xml;q=0.9,*/*;q=0.8; Accept-Language=en-us,en;q=0.5; Sec-Fetch-Mode=navigate}",
    [string]
    $http_headers

    # 1666316745,
    [int]
    $epoch

    # "video",
    [string]
    $_type

    # "@{version=2022.09.01; release_git_head=5d7c7d6; repository=yt-dlp/yt-dlp}"
    [PSCustomObject]
    $_version

}

function Get-InfoType {
    [CmdletBinding()]
    param (
        [Parameter()]
        [ValidateNotNullOrEmpty()]
        [ValidateSet('playlist', 'video')]
        [string]
        $TypeName
    )
    
    if ($TypeName -eq 'playlist') {
        return [PlaylistInfo]
    } elseif ($TypeName -eq 'video') {
        return [VideoInfo]
    }
    return [PSCustomObject]
}

function Get-InfoFiles {
    param (
        # Specifies a path to one or more locations. Wildcards are permitted.
        [Parameter(Mandatory = $false,
            Position = 0,
            ValueFromPipeline,
            ValueFromPipelineByPropertyName,
            HelpMessage = 'Path to one or more locations.')]
        [ValidateNotNullOrEmpty()]
        [SupportsWildcards()]
        [string[]]
        $InputPath = '.',

        [Parameter()]
        [AllowNull()]
        [AllowEmptyCollection()]
        [ValidateSet('playlist', 'video')]
        [string[]]
        $InfoFileTypes,

        [switch]
        $Recurse,

        [switch]
        $ReturnOnlyPropertyNames,

        [switch]
        $AsHashTable
    )
    begin {
        $progressParams = @{
            Activity = 'Locating files'
        }
        Write-Progress @progressParams
        Write-Debug "InfoFIleTypes: $InfoFileTypes"
    }
    process {
        # Define parameters for Get-ChildItems
        $gciParams = @{
            Path    = $InputPath
            Filter  = '*.json'
            File    = $true
            Recurse = $Recurse
        }

        # Define parameters for JSON parsing.
        $cfjParams = @{
            AsHashTable = $AsHashTable
        }

        Get-ChildItem @gciParams | ForEach-Object -Parallel {
            Write-Debug "Current item: $_"
            # Convert to object
            # $o = New-Object PlaylistInfo -Property {$_ | Get-Content | ConvertFrom-Json @using:cfjParams}
            $o = $_ | Get-Content | ConvertFrom-Json @using:cfjParams

            Write-Debug "Current item content: $o"
            if ((-not $InfoFileTypes.Count) -or ($o._type -in $InfoFileTypes)) {
                if ($ReturnOnlyPropertyNames) {
                    return $o.Keys
                }
                else {
                    return [PSCustomObject]@{
                        File = $_.FullName
                        Data = $o
                    }
                }
            }
        } 
            
    }
    end {
        Write-Progress @progressParams -Completed
    }
}

<#
.EXAMPLE
    Get-InfoFiles -Recurse -AsHashtable -InfoFileTypes playlist |  Get-InfoJsonProperties
    uploader
    uploader_id                                                                                                             
    uploader_url                                                                                                            
    thumbnails                                                                                                              
    tags                                                                                                                    
    playlist_count                                                                                                          
    channel_follower_count                                                                                                  
    channel                                                                                                                 
    channel_id                                                                                                              
    channel_url                                                                                                             
    id                                                                                                                      
    title                                                                                                                   
    description                                                                                                             
    _type                                                                                                                   
    webpage_url                                                                                                             
    webpage_url_basename                                                                                                    
    webpage_url_domain                                                                                                      
    extractor                                                                                                               
    extractor_key                                                                                                           
    epoch                                                                                                                   
    _version                                                                                                                
    view_count
    availability                                                                                                            
    modified_date                                                                                                           
    thumbnail
    age_limit   
#>
function Get-InfoJsonProperties {
    param (
        [Parameter(
            ValueFromPipeline,
            ValueFromPipelineByPropertyName
        )]
        [PSObject[]]
        $JsonInfos
    )

    begin {
        $progParams = @{
            Activity = 'Gathering property names'
        }
        Write-Progress @progParams
        $outputSet = [System.Collections.Generic.HashSet[string]]::new()
    }
    process {
        $PSItem 
        | Select-Object -ExpandProperty 'Data' 
        | ForEach-Object {
            $_
        }
        | Select-Object -ExpandProperty Keys 
        | ForEach-Object {
            if ($outputSet.Add($_)) {
                Write-Debug "$($_.GetType())"
                $_
                Write-Progress @progParams -Status "Found $($outputSet.Count) items"
            }
        }
    }
    end {
        Write-Progress @progParams -Completed
        Write-Host "Found $($outputSet.Count) items" -ForegroundColor (($outputSet.Count -gt 0) ? 'Green' : 'DarkRed' )
    }
}

# | ForEach-Object {
#     $o = ($_ | Get-Content | ConvertFrom-Json)
#     # if ($o._type -ieq "playlist") {
#     Write-Output ([PSCustomObject]@{
#             File    = $_
#             Content = $o
#         })
#     # }
# }